# モデルコンテキストプロトコル（MCP）のセキュリティに関する分析レポート

## 1. はじめに

本レポートは、Wiz Blogに掲載された「MCP and LLM Security Research Briefing」を基に、モデルコンテキストプロトコル（MCP）のセキュリティに関する現状と課題、そして将来的な展望について分析する。MCPは、大規模言語モデル（LLM）アプリケーションを外部データソースやツールに接続するための標準規格として注目されており、その普及に伴いセキュリティリスクも増大している。本レポートでは、MCPのセキュリティリスクを詳細に分析し、早期導入者向けの対策、そして将来的なセキュリティ強化の方向性を示す。

## 2. MCPの概要と重要性

MCPは、Anthropic社によって提唱され、OpenAI、Microsoft、Googleなどの主要企業も支持している規格である。LLMと外部システムを連携させることで、開発者は自然言語でWiz Codeの検索結果を問い合わせたり、修正提案を受けたり、自動的に修正プログラムを生成したりすることが可能になる。

## 3. MCPが抱えるセキュリティリスク

MCPは、新たな技術であるため、従来のセキュリティリスクに加えて、特有のリスクも存在する。

### 3.1. 既存のリスク

MCPは、既存のセキュリティリスクを内包している。

* **ツール呼び出しにおけるリスク:** ツール呼び出しには、人間の介入が必要であり、ツールのアノテーションはデフォルトで信頼できないものとして扱う必要がある。
* **APIキーの管理:** APIキーは安全に保管し、ツールの権限を適切に設定する必要がある。
* **データとネットワークセキュリティ:** 標準的なデータとネットワークセキュリティ対策を講じる必要がある。

### 3.2. 新たなリスク

MCPは、新たなリスクも生み出す。

* **ローカルサーバーのリスク:** ローカルサーバーは、任意のコードを実行する可能性があり、サプライチェーンリスクが課題となる。
* **リモートサーバーのリスク:** リモートサーバーは、認証情報の窃盗や不正アクセスにつながる可能性がある。
* **MCPクライアントのリスク:** MCPクライアントは、自動実行されるツールによって、セキュリティリスクが増大する可能性がある。

## 4. 各種サーバーのリスク分析

### 4.1. ローカルサーバー

ローカルサーバーは、LLMクライアントと同じマシンまたは環境で動作する。

* **サプライチェーンリスク:** 開発者による未検証のコードが、機密データやローカルシステムへのアクセスを許可する可能性がある。
* **インストール方法:** 現在のMCPサーバーのインストールは、パッケージ管理システムのような標準化された方法がなく、セキュリティリスクを高める可能性がある。

### 4.2. リモートサーバー

リモートサーバーは、ネットワーク経由でアクセスされ、第三者によって運用される。

* **ベンダーリスク:** リモートサーバーは、認証データ、内部アプリケーションコンテキスト、または顧客情報を保存または処理する可能性があり、データ漏洩、誤処理、または侵害のリスクがある。

### 4.3. MCPクライアント

MCPクライアントは、MCPサーバーの発見、呼び出し、および対話において中心的な役割を果たす。

* **自動実行:** 自動実行は、使いやすさを向上させるが、セキュリティを犠牲にする可能性がある。
* **ツール名の競合:** 攻撃者は、一般的な名前のツールを登録し、正当な機能を上書きまたは偽装する可能性がある。
* **スラッシュコマンドのハイジャック:** `/deploy`や`/scan`などの重複するコマンドが、悪意のあるツールにリダイレクトされる可能性がある。
* **間接的なプロンプトインジェクション:** READMEやコミットメッセージなどの信頼できないコンテンツが、LLMの動作を操作し、意図しないツールの実行を引き起こす可能性がある。

## 5. セキュリティ対策

### 5.1. 現状における対策

MCPのセキュリティ対策は、まだ発展途上であるため、早期導入者は以下の対策を講じる必要がある。

* **信頼できるソースの利用:** 信頼できるプロジェクトやベンダーからMCPサーバーを利用する。
* **利用前の監査:** MCPサーバーを、権限が強化されたパッケージとして扱い、悪意のある動作や設定ミスがないか確認する。
* **最小権限の適用:** トークンのスコープを制限し、広範な権限を避け、認証要求を慎重に扱う。
* **成熟したMCPクライアントの選択:** 監査可能性、承認フロー、権限管理、および全体的なセキュリティ体制を考慮してクライアントを選択する。
* **ローカルサーバーの優先:** 可能であればローカルサーバーを優先し、リモートサーバーは、セキュリティに配慮したベンダーの検証済みのツールに限定する。
* **内部レジストリの検討:** 独自のMCPサーバーのセットを管理し、未知のコードへの露出を減らす。
* **MCPサーバーのサンドボックス化:** コンテナ化、ネットワーク出口制御、およびシステムコールフィルタリングを使用して影響を制限する。
* **MCPゲートウェイの検討:** MCPサーバーの使用を一元化し、監査ログ記録と監視、ガードレール、およびガバナンス制御を可能にする。
* **MCPホストエージェント内での許可リストの検討:** バイナリ許可リストは、関連する脅威に対する役立つ対策である。

### 5.2. 将来的な対策

MCPのセキュリティは、仕様とコミュニティの両方から改善が進んでいる。

* **公式レジストリ:** 署名、ピン留め、およびロックに関するより強力なプリミティブと組み合わせて、整合性、バージョン管理、および信頼を強化する。
* **ツールネームスペース:** Cloudflare社が実装しているように、スコープ付きの命名規則を導入し、あいまいさと悪用を減らす。
* **実行環境の改善:** サンドボックス化、ネットワーク境界、およびきめ細かいリソース制約を導入する。
* **プロキシの活用:** MCP GuardianやMCP Gatewayなどのオープンソースツールを活用し、監査機能、メッセージ承認、サーバー管理、機密データのマスキング、およびプロンプトインジェクションなどの脅威の軽減を図る。
* **きめ細かい権限管理:** ツールのアノテーションを活用し、ユーザーまたは組織レベルでの承認を可能にする。

## 6. まとめ

MCPは急速に発展しており、早期導入者にとっては、セキュリティ対策が重要となる。MCPのセキュリティリスクを理解し、適切な対策を講じることで、安全な利用と開発が可能となる。

| 対策 | 説明 

**元記事:** [MCP and LLM Security Research Briefing Wiz Blog](https://www.wiz.io/blog/mcp-security-research-briefing)